{"ts":1341119574636,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/* \nNOTE: The Trello client library has been included as a Managed Resource.  To include the client library in your own code, you would include jQuery and then\n\n<script src=\"https://api.trello.com/1/client.js?key=your_application_key\">...\n\nSee https://trello.com/docs for a list of available API URLs\n\nThe API development board is at https://trello.com/api\n\nThe &dummy=.js part of the managed resource URL is required per http://doc.jsfiddle.net/basic/introduction.html#add-resources\n*/\n//-Basics-\nvar updateLoggedIn = function() {\n    var isLoggedIn = Trello.authorized();\n    $(\"#loggedout\").toggle(!isLoggedIn);\n    $(\"#loggedin\").toggle(isLoggedIn);\n};\nvar logout = function() {\n    Trello.deauthorize();\n    updateLoggedIn();\n};\nTrello.authorize({\n    interactive: false,\n    success: onAuthorize\n});\n$(\"#connectLink\").click(function() {\n    Trello.authorize({\n        type: \"popup\",\n        success: onAuthorize\n    });\n});\n$(\"#disconnect\").click(logout);\n//Connect\nvar onAuthorize = function() {\n    updateLoggedIn();\n    $(\"#output\").empty();\n    //get member info\n    Trello.members.get(\"me\", function(member) {\n        ShowUsername(member);\n        localStorage.memberId = member.id;\n        localStorage.connectTime = moment(new Date()).utc();\n        $(\"<div>\").text(\"Loading Data...\").appendTo(\"#output\");\n        try {\n            //Display member boards\n            if (member.idBoards.length > 0) {\n                $(\"#output\").text(\"\");\n                $(\"<select>\").attr({\n                    id: 'boards',\n                    class: 'span4'\n                }).appendTo(\"#output\");\n                $('#boards').append(new Option(\"Select Board\", null));\n                $('#boards').change(function(e) {\n                    ChangeBoard($(this).val());\n                });\n                $.each(member.idBoards, function(index, value) {\n                    Trello.get('/boards/' + value, {}, function(r) {\n                        //console.log(r);\n                        if (!r.closed) {\n                            if (r.desc !== null) {\n                                $('#boards').append(new Option(r.name, r.id));\n                            }\n                        }\n                    });\n                });\n            }\n        } catch (e) {\n            //Dont work\n            console.log('Error al cargar Boards' + e);\n        }\n    });\n};\n//Load Board,List,Card\nvar ChangeBoard = function(boardId) {\n    if (boardId !== null) {\n        try {\n            $(\"#lists> option\").remove();\n            $(\"#cards> option\").remove();\n            $('#lists').append(new Option(\"Select List\", \"noId\"));\n        } catch (e) {}\n        Trello.get('/boards/' + boardId + '/lists', {}, function(lists) {\n            if (!$(\"#lists\").length) {\n                $(\"<select>\").attr({\n                    id: 'lists',\n                    class: 'span4'\n                }).appendTo(\"#output\");\n                $('#lists').append(new Option(\"Select List\", \"noId\"));\n            }\n            $('#lists').change(function(e) {\n                ChangeList($(this).val());\n            });\n            $.each(lists, function(index, list) {\n                //console.log(list);\n                if (!list.closed) {\n                    $('#lists').append(new Option(list.name, list.id));\n                }\n            });\n        });\n    }\n}\nvar ChangeList = function(listId) {\n    console.log(listId);\n    if (listId !== \"noId\") {\n        try {\n            $(\"#cards> option\").remove();\n        } catch (e) {}\n        Trello.get('/lists/' + listId + '/cards', {}, function(cards) {\n            console.log(cards);\n            if (!$(\"#cards\").length) {\n                $(\"<select>\").attr({\n                    id: 'cards',\n                    class: 'span4'\n                }).appendTo(\"#output\");\n            }\n            $('#cards').change(function(e) {\n                ChangeCard($(this).val());\n            });\n            $.each(cards, function(index, card) {\n                console.log(card);\n                if (!card.closed) {\n                    console.log(\"localStorage.memberId\" + localStorage.memberId);\n                    $.each(card.idMembers, function(index, member) {\n                        console.log(\"member\" + member);\n                        if (member == localStorage.memberId) {\n                            $('#cards').append(new Option(card.name, card.id));\n                        }\n                    });\n                }\n            });           \n            if ($('#cards option').length > 0) {\n            console.log('Tarjetas asignadas' + $('#cards option').length );\n            }else{\n            console.log('No hay tarjetas asignadas');\n            }\n        });\n    }\n}\nvar ChangeCard = function(cardId) {\n    console.log(cardId);\n    try {\n        console.log(\"Change card\");\n    } catch (e) {\n        console.log(\"Error Change card\" + e);\n    }\n}\n//Set divs with user info\nvar ShowUsername = function(member) {\n    try {\n        $(\"#linkProfile\").attr('href', function(i) {\n            return \"https://trello.com/\" + member.username;\n        });\n        $(\"#linkProfile2\").attr('href', function(i) {\n            return \"https://trello.com/\" + member.username;\n        });\n        $(\"#fullName\").val(member.fullName);\n    } catch (e) {\n        console.log('Error al cargar datos del usuario ' + e)\n    }\n};\n//THE REAL FUN\n$(\"#btnLog\").click(function() {\n    var input = $(\"#logInput\");\n    var log = $(\"#logHistory\");\n    console.log(input);\n    if (input.val() != \"\") {\n        var now = moment(new Date()).utc();\n        var dataString = now.format(\"MMMM Do YYYY, h:mm a\") + '\\n' + input.val() + '\\n' + log.val();\n        log.val(dataString);\n        input.val('');\n    }\n});\n$(\"#btnStart\").click(function() {\n    if (!$(\"#cards\").length) {\n        console.log(\"no hay tarea escogida\");\n    } else {\n        try {\n            var now = moment(new Date()).utc();\n            var dataString = \"\\n\" + now.format(\"MMMM Do YYYY, h:mm a\") + \" UTC\" + \"\\n\";\n            if (localStorage.cardStart) {\n                localStorage.cardStart = false;\n                dataString += \"<strong>Finish working on </strong> \" + $(\"#cards option:selected\").text();\n                $(\"#output\").show();\n            } else {\n                localStorage.cardStart = true;\n                dataString += \"<strong>Start working in </strong> \" + $(\"#cards option:selected\").text();\n                $(\"#output\").hide();\n            }\n            $(\"#logHistory\").val(function(prev) {\n                if (prev == 0) {\n                    return dataString;\n                } else {\n                    return prev + dataString;\n                }\n            });\n            \n        }\n        catch (e) {\n            console.log(\"fallo actualizar log\");\n        }\n    }\n});â€‹"]],"start1":0,"start2":0,"length1":0,"length2":6799}]],"length":6799}
